---
import Layout from '../layouts/Layout.astro';
import NotionRenderer from '../components/Glaze/NotionRenderer.astro';
import { getPageBySlug, getBlocks, mapPageProperties } from "../lib/notion";

const { slug } = Astro.params;

// 1. 데이터 조회
const pageRaw = await getPageBySlug(slug!);

if (!pageRaw) {
  return Astro.redirect('/404');
}

const page = mapPageProperties(pageRaw);
const blocks = await getBlocks(pageRaw.id);
---

<Layout title={page.title}>
  <main class="max-w-4xl mx-auto px-6 py-20">
    <header class="mb-16 text-center">
      <h1 class="text-4xl md:text-5xl font-black text-slate-900 mb-6">
        {page.title}
      </h1>
      <div class="w-20 h-1.5 bg-primary mx-auto rounded-full"></div>
    </header>

    <div class="bg-white dark:bg-slate-900 p-8 md:p-12 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800">
      <div class="notion-renderer">
          <NotionRenderer blocks={blocks} />
      </div>
    </div>
  </main>
</Layout>
